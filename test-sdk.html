<!doctype html>
<html>
  <head>
    <title>Payment Gateway SDK Test</title>
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 800px;
        margin: 50px auto;
        padding: 20px;
      }
      h1 {
        color: #333;
      }
      button {
        padding: 15px 30px;
        font-size: 18px;
        background-color: #007bff;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background-color: #0056b3;
      }
      .result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 5px;
      }
      .success {
        background-color: #d4edda;
        color: #155724;
        border: 1px solid #c3e6cb;
      }
      .error {
        background-color: #f8d7da;
        color: #721c24;
        border: 1px solid #f5c6cb;
      }
    </style>
  </head>
  <body>
    <h1>Payment Gateway SDK Test</h1>
    <p>Click the button below to open the payment modal using the SDK.</p>

    <button id="pay-button">Pay ₹500.00 with SDK</button>

    <div id="result"></div>

    <script src="http://localhost:3001/checkout.js"></script>

    <script>
      document
        .getElementById("pay-button")
        .addEventListener("click", async function () {
          const resultDiv = document.getElementById("result");
          resultDiv.innerHTML = "<p>Creating order...</p>";

          try {
            const orderResponse = await fetch(
              "http://localhost:8000/api/v1/orders",
              {
                method: "POST",
                headers: {
                  "X-Api-Key": "key_test_abc123",
                  "X-Api-Secret": "secret_test_xyz789",
                  "Content-Type": "application/json",
                },
                body: JSON.stringify({
                  amount: 50000,
                  currency: "INR",
                  receipt: "sdk_test_" + Date.now(),
                }),
              },
            );

            const order = await orderResponse.json();
            console.log("✓ Order created:", order.id);
            resultDiv.innerHTML =
              "<p>Order created: " +
              order.id +
              "</p><p>Opening payment modal...</p>";

            const checkout = new PaymentGateway({
              key: "key_test_abc123",
              orderId: order.id,
              onSuccess: function (response) {
                console.log("✓ Payment successful!", response);
                resultDiv.innerHTML =
                  '<div class="result success">' +
                  "<h3>✓ Payment Successful!</h3>" +
                  "<p><strong>Payment ID:</strong> " +
                  response.paymentId +
                  "</p>" +
                  "<p><strong>Order ID:</strong> " +
                  response.orderId +
                  "</p>" +
                  "<p><strong>Amount:</strong> ₹" +
                  (response.amount / 100).toFixed(2) +
                  "</p>" +
                  "</div>";
              },
              onFailure: function (error) {
                console.log("✗ Payment failed", error);
                resultDiv.innerHTML =
                  '<div class="result error">' +
                  "<h3>✗ Payment Failed</h3>" +
                  "<p>" +
                  (error.error || "Payment could not be processed") +
                  "</p>" +
                  "</div>";
              },
              onClose: function () {
                console.log("Modal closed");
              },
            });

            checkout.open();
          } catch (error) {
            console.error("Error:", error);
            resultDiv.innerHTML =
              '<div class="result error">' +
              "<h3>Error</h3>" +
              "<p>" +
              error.message +
              "</p>" +
              "</div>";
          }
        });
    </script>
  </body>
</html>
